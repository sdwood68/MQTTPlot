<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>MQTTPlot</title>

<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<link rel="stylesheet" href="/static/mqttplot.css">
<script src="/static/mqttplot.js" defer></script>

</head>

<body
  class="{{ 'admin' if admin else '' }}"
  data-admin="{{ 'true' if admin else 'false' }}"
>


<div id="admin-bar">
    {% if admin %}
        <span><b>Admin:</b> {{ admin_user if admin_user else "yes" }}</span>
        <a href="/admin/logout">Logout</a>
    {% else %}
        <a href="/admin/login">Admin Login</a>
    {% endif %}
</div>

<h2>MQTTPlot</h2>
<p><b>Broker:</b> {{ broker }}</p>

{% if admin %}
<div class="admin-box">
    <b>Admin Mode Enabled</b>
</div>
{% endif %}

<h3>Topics</h3>
<div id="topics"></div>

<h3>Plot Data</h3>
<label>Topic:
<input id="topicInput" list="topiclist">
</label>
<label>From:
<input id="start" placeholder="ISO time or epoch (optional)">
</label>
<label>To:
<input id="end" placeholder="ISO time or epoch (optional)">
</label>

<button onclick="plot()">Plot</button>

<!-- v0.6.0 plot window controls -->
<div style="margin-top: 8px;">
  <button onclick="slideWindow(-0.5)">◀ Back 50%</button>
  <button onclick="slideWindow(0.5)">Forward 50% ▶</button>
  <button onclick="zoomWindow(0.5)">Zoom In</button>
  <button onclick="zoomWindow(2.0)">Zoom Out</button>
</div>

<datalist id="topiclist"></datalist>
<div id="plot"></div>

{% if admin %}
<div class="admin-box">
    <h3>OTA Control</h3>
    <input id="otaBase" placeholder="Base topic (e.g. watergauge)">
    <button onclick="sendOTA(1)">Enter OTA</button>
    <button onclick="sendOTA(0)">Exit OTA</button>
</div>
{% endif %}

</body>
</html>
